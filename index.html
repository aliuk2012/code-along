<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>code-along</title>
    <style media="screen">
      body {margin:0;height: 100vh; display: flex}
      iframe, textarea {margin:0;display: block; width: 100%; flex: 1}
      textarea {font-family: monospace; font-size: 1.25em; border:none}
    </style>
  </head>
  <body>
    <iframe src="about:blank"></iframe>
    <textarea name="name">document.body.style.background = '#08f'</textarea>

    <script type="text/javascript">
      var textarea = document.querySelector('textarea')
      var iframe   = document.querySelector('iframe')

      var template = fetch('template.txt')
                       .then(r => r.text())

      function load(){
        template
          .then(text => {

            URL.revokeObjectURL(iframe.src)

            var blob = new Blob([text
              .split('{{INJECT}}')
              .join(textarea.value)], {type: 'text/html'})

            var url = URL.createObjectURL(blob)
            iframe.src = url
          })

      }

      load()
      textarea.onkeyup = load

      var steps = []
      //
      // fetch('/data/_meta.json')
      //   .then(res => res.json())
      //   .then(items => {
      //     var requests = items.map(s => fetch(s.path).then(res => res.text()))
      //     Promise.all(requests)
      //       .then(_steps => {
      //         steps = _steps
      //         steps.forEach((s) => {
      //           var li = document.createElement('li')
      //           li.innerText = s
      //           document.getElementById('history').appendChild(li)
      //         })
      //       })
      //     // console.log(items)
      //   })


    </script>
  </body>
</html>
